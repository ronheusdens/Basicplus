10 CLS
20 BASE=15360
30 SCORE1=0: SCORE2=0
40 TOP=1: BOTTOM=22
50 LEFT_BORDER=0: RIGHT_BORDER=79
60 PADDLE_W=2: PADDLE_H=4
70 LEFT_X=2: RIGHT_X=77
80 P1Y=10: P2Y=10
90 BX=40: BY=12: DX=1: DY=1
100 GOSUB 5000
110 OP1Y=P1Y: OP2Y=P2Y: OBX=BX: OBY=BY
120 PX=LEFT_X: PY=P1Y: PCH=219: GOSUB 9100
121 PX=RIGHT_X: PY=P2Y: PCH=219: GOSUB 9100
122 R=BY: C=BX: CH=233: GOSUB 9000
130 REM ---- main loop ----
140 A$=INKEY$
150 IF A$="Q" OR A$="q" THEN END
160 IF A$="W" OR A$="w" OR A$="S" OR A$="s" OR A$="O" OR A$="o" OR A$="L" OR A$="l" THEN
161   IF A$="W" OR A$="w" THEN P1Y=P1Y-1
162   IF A$="S" OR A$="s" THEN P1Y=P1Y+1
163   IF A$="O" OR A$="o" THEN P2Y=P2Y-1
164   IF A$="L" OR A$="l" THEN P2Y=P2Y+1
165 ENDIF
200 IF P1Y<TOP OR P1Y> BOTTOM-PADDLE_H+1 OR P2Y<TOP OR P2Y> BOTTOM-PADDLE_H+1 THEN
201   IF P1Y<TOP THEN P1Y=TOP
202   IF P1Y> BOTTOM-PADDLE_H+1 THEN P1Y=BOTTOM-PADDLE_H+1
203   IF P2Y<TOP THEN P2Y=TOP
204   IF P2Y> BOTTOM-PADDLE_H+1 THEN P2Y=BOTTOM-PADDLE_H+1
205 ENDIF
240 BX=BX+DX: BY=BY+DY
250 IF BY<=TOP THEN BY=TOP: DY=1
260 IF BY>=BOTTOM THEN BY=BOTTOM: DY=-1
270 IF BX=LEFT_X+PADDLE_W AND BY>=P1Y AND BY<P1Y+PADDLE_H THEN DX=1: BEEP 50
280 IF BX=RIGHT_X-1 AND BY>=P2Y AND BY<P2Y+PADDLE_H THEN DX=-1: BEEP 50
290 IF BX<=LEFT_BORDER THEN SCORE2=SCORE2+1: DX=1: GOSUB 6000
300 IF BX>=RIGHT_BORDER THEN SCORE1=SCORE1+1: DX=-1: GOSUB 6000
310 REM ---- erase old ball ----
311 R=OBY: C=OBX: CH=32: GOSUB 9000
312 REM ---- update paddles (only changed rows) ----
313 IF P1Y<OP1Y THEN FOR C=LEFT_X TO LEFT_X+PADDLE_W-1: A=BASE + (OP1Y+PADDLE_H-1)*80 + C: POKE A, 32: NEXT C: FOR C=LEFT_X TO LEFT_X+PADDLE_W-1: A=BASE + (P1Y)*80 + C: POKE A, 219: NEXT C
314 IF P1Y>OP1Y THEN FOR C=LEFT_X TO LEFT_X+PADDLE_W-1: A=BASE + (OP1Y)*80 + C: POKE A, 32: NEXT C: FOR C=LEFT_X TO LEFT_X+PADDLE_W-1: A=BASE + (P1Y+PADDLE_H-1)*80 + C: POKE A, 219: NEXT C
315 IF P2Y<OP2Y THEN FOR C=RIGHT_X TO RIGHT_X+PADDLE_W-1: A=BASE + (OP2Y+PADDLE_H-1)*80 + C: POKE A, 32: NEXT C: FOR C=RIGHT_X TO RIGHT_X+PADDLE_W-1: A=BASE + (P2Y)*80 + C: POKE A, 219: NEXT C
316 IF P2Y>OP2Y THEN FOR C=RIGHT_X TO RIGHT_X+PADDLE_W-1: A=BASE + (OP2Y)*80 + C: POKE A, 32: NEXT C: FOR C=RIGHT_X TO RIGHT_X+PADDLE_W-1: A=BASE + (P2Y+PADDLE_H-1)*80 + C: POKE A, 219: NEXT C
317 ' No full redraw needed
318 ' No full redraw needed
317 PX=LEFT_X: FOR I=0 TO PADDLE_H-1: PY=P1Y+I: PCH=219: GOSUB 9200: NEXT I
318 PX=RIGHT_X: FOR I=0 TO PADDLE_H-1: PY=P2Y+I: PCH=219: GOSUB 9200: NEXT I
318 REM ---- draw new ball ----
319 R=BY: C=BX: CH=233: GOSUB 9000
320 OBX=BX: OBY=BY
321 OP1Y=P1Y: OP2Y=P2Y
330 GOSUB 7000
340 GOTO 140
5000 REM ---- draw border and score: ----
5010 CLS
5020 GOSUB 5100
5025 GOSUB 5200
5030 FOR R=TOP TO BOTTOM
5040 A=BASE + R*80 + LEFT_BORDER: POKE A, 124
5050 A=BASE + R*80 + RIGHT_BORDER: POKE A, 124
5060 NEXT R
5070 R=BOTTOM+1
5080 IF R<=23 THEN FOR C=0 TO 79: A=BASE + R*80 + C: POKE A, 45: NEXT C
5090 RETURN
5100 REM ---- draw score labels ----
5110 PRINT@ 0, "Score: ";
5112 PRINT@ 12, " points";
5115 PRINT@ 34, "W/S O/L  Q";
5120 PRINT@ 55, "Score: ";
5122 PRINT@ 67, " points";
5125 RETURN
5200 REM ---- update score numbers only ----
5210 FOR C=8 TO 11: A=BASE + C: POKE A, 32: NEXT C
5215 FOR C=63 TO 66: A=BASE + C: POKE A, 32: NEXT C
5220 S1$=STR$(SCORE1): PRINT@ 8, S1$;
5225 S2$=STR$(SCORE2): PRINT@ 63, S2$;
5230 RETURN
6000 REM ---- reset ball after score ----
6010 BX=40: BY=12: DY=1
6020 GOSUB 5200
6030 RETURN
7000 REM ---- delay ----
7010 FOR D=1 TO 600: NEXT D
7020 RETURN
9000 REM ---- poke character at R,C ----
9010 A=BASE + R*80 + C
9020 POKE A, CH
9030 RETURN
9100 REM ---- draw paddle at PX,PY with PCH ----
9110 FOR R=PY TO PY+PADDLE_H-1
9120 FOR C=PX TO PX+PADDLE_W-1
9130 A=BASE + R*80 + C: POKE A, PCH
9140 NEXT C
9150 NEXT R
9160 RETURN
9200 REM ---- draw paddle row at PX,PY with PCH ----
9210 FOR C=PX TO PX+PADDLE_W-1
9220 A=BASE + PY*80 + C: POKE A, PCH
9230 NEXT C
9240 RETURN
